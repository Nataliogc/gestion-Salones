<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>MesaChef Matrix ¬∑ Salones</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="Img/mesa-chef-192.png" />
    <link rel="apple-touch-icon" href="Img/mesa-chef-192.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#475569',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Segoe UI', sans-serif;
        }

        .modal-content {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        input,
        select,
        textarea {
            border: 1px solid #cbd5e1;
            border-radius: 0.5rem;
            padding: 0.5rem;
            width: 100%;
            outline: none;
        }

        input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 2px #bfdbfe;
            outline: none;
        }

        label {
            font-size: 0.75rem;
            font-weight: 700;
            color: #64748b;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
            display: block;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800">

    <!-- NAV -->
    <!-- NAV COMPACT & PREMIUM -->
    <nav class="bg-white shadow-sm sticky top-0 z-30 border-b border-gray-200 h-14">
        <div class="max-w-[98%] mx-auto px-4 h-full">
            <div class="flex justify-between items-center h-full">

                <!-- LEFT: SYSTEM IDENTITY -->
                <div class="flex items-center gap-4">
                    <!-- Brand -->
                    <!-- Brand -->
                    <div class="flex items-center gap-3">
                        <img src="Img/logo_mesa_chef.png" class="h-8 w-auto object-contain drop-shadow-sm"
                            alt="MesaChef">
                        <div class="flex flex-col leading-none">
                            <h1 class="text-slate-800 font-bold text-lg tracking-tight">MesaChef</h1>
                            <span
                                class="text-[10px] text-blue-600 font-bold uppercase tracking-widest -mt-0.5">Matrix</span>
                        </div>
                    </div>

                    <!-- Divider -->
                    <div class="h-6 w-px bg-slate-200"></div>

                    <!-- Module Indicator -->
                    <span class="text-slate-500 font-semibold text-sm tracking-wide uppercase">Eventos y Salones</span>
                </div>

                <!-- CENTER: STATUS & HOTEL -->
                <div class="flex items-center gap-6 flex-1 justify-center min-w-0 mx-4">
                    <!-- Connection Status -->
                    <div class="flex items-center gap-2 px-3 py-0.5 bg-green-50 rounded-full border border-green-100"
                        id="connStatus">
                        <div
                            class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse shadow-[0_0_6px_rgba(34,197,94,0.6)]">
                        </div>
                        <span class="text-[10px] font-bold text-green-700 uppercase tracking-wide">Online</span>
                    </div>

                    <!-- Hotel Name (Injected) -->
                    <div id="headerHotelName" class="text-sm font-semibold text-slate-700 flex items-center">
                        <!-- JS Injects Logo + Name here -->
                    </div>
                </div>

                <!-- RIGHT: ACTIONS -->
                <div class="flex items-center gap-3">
                    <a href="restaurante.html"
                        class="group flex items-center gap-1.5 text-blue-600 hover:text-blue-800 transition px-3 py-1.5 rounded-md hover:bg-blue-50">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
                            </path>
                        </svg>
                        <span class="text-xs font-bold uppercase tracking-wide">Restaurante</span>
                    </a>

                    <a href="presupuestos.html"
                        class="group flex items-center gap-1.5 text-blue-600 hover:text-blue-800 transition px-3 py-1.5 rounded-md hover:bg-blue-50">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
                            </path>
                        </svg>
                        <span class="text-xs font-bold uppercase tracking-wide">Presupuestos</span>
                    </a>

                    <div class="h-6 w-px bg-slate-200 mx-1"></div>

                    <a href="index.html"
                        class="group flex items-center gap-1.5 text-slate-500 hover:text-slate-800 transition px-3 py-1.5 rounded-md hover:bg-slate-50">
                        <svg class="w-4 h-4 text-slate-400 group-hover:text-slate-600" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        <span class="text-xs font-semibold">Volver al Inicio</span>
                    </a>

                    <div class="h-6 w-px bg-slate-200 mx-1"></div>

                    <button onclick="openBooking()"
                        class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 px-4 rounded shadow-sm hover:shadow flex items-center gap-2 transition transform active:scale-95">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        NUEVO EVENTO
                    </button>
                </div>

            </div>
        </div>
    </nav>

    <!-- CONTENT -->
    <div class="w-full px-4 lg:px-6 py-6" id="app">

        <!-- Toolbar (Unified Design) -->
        <div
            class="bg-white border-b border-gray-200 px-4 py-3 flex flex-col md:flex-row justify-between items-center gap-4 shadow-sm mb-6 rounded-lg">
            <!-- LEFT: Date & Actions -->
            <div class="flex items-center gap-3">
                <!-- Navigation -->
                <div class="flex items-center gap-1">
                    <button onclick="changeWeek(-1)"
                        class="w-8 h-8 flex items-center justify-center bg-white border border-slate-300 rounded-md text-slate-600 hover:bg-slate-50 hover:text-blue-600 transition shadow-sm active:scale-95">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7">
                            </path>
                        </svg>
                    </button>
                    <div class="relative group">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-4 h-4 text-slate-400 group-hover:text-blue-500 transition" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                        </div>
                        <input type="date" id="currentDate" onchange="renderGrid()"
                            class="pl-10 pr-3 py-1.5 border border-slate-300 rounded-md text-sm text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none w-40 transition shadow-sm h-8 font-medium cursor-pointer hover:border-blue-400" />
                    </div>
                    <button onclick="changeWeek(1)"
                        class="w-8 h-8 flex items-center justify-center bg-white border border-slate-300 rounded-md text-slate-600 hover:bg-slate-50 hover:text-blue-600 transition shadow-sm active:scale-95">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                            </path>
                        </svg>
                    </button>
                </div>

                <!-- Separator -->
                <div class="h-6 w-px bg-slate-200 mx-1"></div>

                <!-- Print/View Buttons -->
                <div class="flex items-center gap-2">
                    <button onclick="printReport('semana')"
                        class="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 rounded-md text-xs font-bold text-slate-700 hover:bg-slate-50 hover:text-blue-600 transition shadow-sm h-8 active:scale-95">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                        </svg>
                        Semana
                    </button>
                    <button onclick="printReport('dia')"
                        class="flex items-center gap-2 px-3 py-1.5 bg-white border border-slate-300 rounded-md text-xs font-bold text-slate-700 hover:bg-slate-50 hover:text-blue-600 transition shadow-sm h-8 active:scale-95">
                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                            </path>
                        </svg>
                        Diario
                    </button>
                </div>
            </div>

            <!-- RIGHT: Filters & Search -->
            <div class="flex items-center gap-3 w-full md:w-auto">
                <!-- Search -->
                <div class="relative group flex-1 md:flex-none">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="w-4 h-4 text-slate-400 group-focus-within:text-blue-500 transition" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" id="searchInput" placeholder="Buscar..." oninput="handleSearch(this.value)"
                        class="w-full md:w-64 pl-10 pr-4 py-1.5 border border-slate-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition shadow-sm h-9" />
                    <!-- Search Results Dropdown -->
                    <div id="searchResults"
                        class="hidden absolute top-full left-0 right-0 bg-white border border-slate-200 rounded-lg shadow-xl mt-1 max-h-96 overflow-y-auto z-50">
                    </div>
                </div>

                <!-- Filter -->
                <select id="filterStatus" onchange="renderGrid()"
                    class="pl-3 pr-8 py-1.5 border border-slate-300 rounded-md text-sm text-slate-700 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition shadow-sm h-9 bg-white cursor-pointer hover:border-slate-400">
                    <option value="activos" selected>Activos</option>
                    <option value="todos">Todos</option>
                    <option value="confirmada">Confirmados</option>
                    <option value="provisional">Pendientes</option>
                    <option value="cancelada">Cancelados</option>
                </select>
            </div>

            <!-- Print Area -->
            <div id="printArea" class="hidden print:block fixed inset-0 bg-white z-[9999] p-8"></div>
        </div>
    </div>

    <!-- Main Grid Container -->
    <div id="calendarGrid" class="flex-1 overflow-auto">
        <div class="flex flex-col items-center justify-center p-10 h-64 text-slate-400">
            <span class="text-4xl mb-4 animate-bounce">‚è≥</span>
            <span class="font-bold text-lg">Cargando aplicaci√≥n...</span>
        </div>
    </div>
    <div id="modal-evt" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                <div
                    class="relative transform overflow-hidden rounded-xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-5xl modal-content">

                    <div class="bg-white px-4 py-2 border-b flex justify-between items-center bg-gray-50">
                        <div class="flex items-center gap-2">
                            <h3 class="text-lg font-bold text-slate-800">Evento</h3>
                            <div id="evt-budget-label"></div>
                        </div>
                        <button onclick="closeModal()"
                            class="text-slate-400 hover:text-slate-600 font-bold text-xl">&times;</button>
                    </div>

                    <div class="px-4 py-3 space-y-3 bg-white">

                        <!-- ROW 1: LOGISTICS (Fecha, Hora, Sal√≥n, Estado) -->
                        <div class="grid grid-cols-12 gap-3">
                            <div class="col-span-2">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Fecha</label>
                                <input type="date" id="evt-fecha"
                                    class="w-full text-sm font-bold bg-gray-50 border-gray-200 rounded h-9">
                            </div>
                            <div class="col-span-2">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Hora</label>
                                <input type="time" id="evt-hora" class="w-full text-xs border-gray-200 rounded h-9">
                            </div>
                            <div class="col-span-5">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Sal√≥n</label>
                                <select id="evt-salon" onchange="updateRentalPrice()"
                                    class="w-full text-sm font-bold bg-gray-50 border-gray-200 rounded h-9">
                                </select>
                            </div>
                            <div class="col-span-3">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Estado</label>
                                <select id="evt-estado" class="w-full text-xs font-bold border-gray-200 rounded h-9">
                                    <option value="presupuesto">üü† Presupuesto</option>
                                    <option value="provisional">üü° Provisional</option>
                                    <option value="confirmada" selected>üü¢ Confirmada</option>
                                    <option value="cancelada">üî¥ Cancelada</option>
                                </select>
                            </div>
                        </div>

                        <!-- ROW 2: CLIENT (Nombre, Tel, Email) -->
                        <div class="grid grid-cols-12 gap-3 bg-blue-50/50 p-2 rounded -mx-2 border border-blue-50/50">
                            <div class="col-span-6">
                                <label class="text-[10px] uppercase font-bold text-blue-400">Cliente /
                                    Evento</label>
                                <input type="text" id="evt-nombre" placeholder="Nombre del cliente o evento..."
                                    class="w-full text-sm font-bold border-gray-200 rounded h-9">
                            </div>
                            <div class="col-span-3">
                                <label class="text-[10px] uppercase font-bold text-blue-400">Tel√©fono</label>
                                <input type="tel" id="evt-telefono" placeholder="Tel..."
                                    class="w-full text-xs border-gray-200 rounded h-9">
                            </div>
                            <div class="col-span-3">
                                <label class="text-[10px] uppercase font-bold text-blue-400">Email</label>
                                <input type="email" id="evt-email" placeholder="@"
                                    class="w-full text-xs border-gray-200 rounded h-9">
                            </div>
                        </div>

                        <!-- ROW 3: OPERATIONS (Jornada, Montaje, Pax) -->
                        <div class="grid grid-cols-12 gap-3">
                            <div class="col-span-3">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Jornada</label>
                                <select id="evt-jornada" onchange="updateRentalPrice()"
                                    class="w-full text-xs border-gray-200 rounded h-9">
                                    <option value="todo">Todo el d√≠a</option>
                                    <option value="ma√±ana">Ma√±ana</option>
                                    <option value="tarde">Tarde</option>
                                </select>
                            </div>
                            <div class="col-span-5">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Montaje</label>
                                <select id="evt-montaje" class="w-full text-xs border-gray-200 rounded h-9"></select>
                            </div>
                            <div class="col-span-2">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Pax Adultos</label>
                                <input type="number" id="evt-pax-a" placeholder="0" oninput="syncPaxFromHeaderToLines()"
                                    class="w-full text-xs border-gray-200 rounded h-9 text-center">
                            </div>
                            <div class="col-span-2">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Pax Ni√±os</label>
                                <input type="number" id="evt-pax-n" placeholder="0" oninput="syncPaxFromHeaderToLines()"
                                    class="w-full text-xs border-gray-200 rounded h-9 text-center">
                            </div>
                        </div>

                        <hr class="border-gray-100 my-1">

                        <!-- SERVICES -->
                        <div>
                            <div class="flex justify-between items-center mb-1">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Servicios</label>
                                <div class="text-right font-bold text-sm">Total: <span id="evt-total"
                                        class="text-blue-600">0.00 ‚Ç¨</span></div>
                            </div>
                            <div class="bg-gray-50 border rounded shadow-inner max-h-40 overflow-y-auto">
                                <table class="w-full text-xs">
                                    <thead class="bg-gray-100 sticky top-0">
                                        <tr>
                                            <th class="p-1 w-24">Fecha</th>
                                            <th class="p-1 text-left">Concepto</th>
                                            <th class="p-1 w-14 text-center">Uds</th>
                                            <th class="p-1 w-24 text-right">Pre</th>
                                            <th class="p-1 w-28 text-right">Tot</th>
                                            <th class="p-1 w-6"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="services-list" class="divide-y divide-gray-200"></tbody>
                                </table>
                            </div>
                            <div class="flex justify-between mt-1">
                                <button onclick="addServiceRow()"
                                    class="text-blue-600 font-bold text-xs hover:underline">+ A√±adir Item</button>
                                <button
                                    class="bg-purple-100 text-purple-700 text-[10px] px-2 py-0.5 rounded font-bold hover:bg-purple-200">‚ú®
                                    AI Menu</button>
                            </div>
                        </div>

                        <!-- NOTES & CHECK -->
                        <div class="grid grid-cols-12 gap-3 mt-2">
                            <div class="col-span-12">
                                <div class="flex items-center space-x-2 mb-1 pl-1">
                                    <input type="checkbox" id="evt-revisado"
                                        class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500">
                                    <label for="evt-revisado"
                                        class="text-xs font-bold text-slate-700 select-none cursor-pointer">Evento
                                        Revisado</label>
                                </div>
                            </div>
                            <div class="col-span-6">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Nota Interna</label>
                                <textarea id="evt-nota-interna" rows="1"
                                    class="w-full text-xs border-gray-200 rounded resize-none focus:h-16 transition-all"
                                    placeholder="S√≥lo visible para nosotros..."></textarea>
                            </div>
                            <div class="col-span-6">
                                <label class="text-[10px] uppercase font-bold text-gray-500">Nota Cliente</label>
                                <textarea id="evt-nota-cliente" rows="1"
                                    class="w-full text-xs border-gray-200 rounded resize-none focus:h-16 transition-all"
                                    placeholder="Visible para cliente..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="bg-gray-50 px-4 py-2 flex justify-between items-center border-t">
                        <button class="text-red-400 hover:text-red-600 text-xs font-bold" onclick="deleteBooking()">üóëÔ∏è
                            Eliminar</button>
                        <div class="flex gap-2">
                            <button class="text-purple-600 hover:text-purple-800 text-xs font-bold mr-4"
                                onclick="createGrandEvent()">üéâ Crear Gran Evento</button>
                            <button
                                class="bg-white text-gray-700 font-bold py-1 px-3 border rounded text-xs hover:bg-gray-50"
                                onclick="closeModal()">Cancelar</button>
                            <button
                                class="bg-slate-800 text-white font-bold py-1 px-4 rounded text-xs hover:bg-black shadow"
                                onclick="saveBooking()">GUARDAR</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Datalist for Concepts -->
    <datalist id="charge-options"></datalist>

    <script src="js/app-common.js"></script>
    <script src="js/salones.js?v=9.6"></script>
</body>

</html>